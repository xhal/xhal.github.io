{
    "version": "https://jsonfeed.org/version/1",
    "title": "星辰大海 • All posts by \"shell\" tag",
    "description": "学习、编程、生活",
    "home_page_url": "http://xsea.cc",
    "items": [
        {
            "id": "http://xsea.cc/2023/03/1e014c62.html",
            "url": "http://xsea.cc/2023/03/1e014c62.html",
            "title": "Windows切换JDK版本（Bat脚本）",
            "date_published": "2023-03-21T06:46:57.000Z",
            "content_html": "<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/assets/css/APlayer.min.css\"><script src=\"/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><blockquote>\n<p>当我们系统中有多个 JDK 版本时，要切换时每次都要手动修改：</p>\n<p>右键打开我的电脑 &gt;&gt; 属性 &gt;&gt; 系统高级设置 &gt;&gt; 环境变量， 修改 JAVA_HOME 的值</p>\n<p>非常麻烦，所以写个脚本，一键搞定；</p>\n</blockquote>\n<p>先来看看效果：</p>\n<p><img data-src=\"https://static.xhal.net/picgo/uTools_1679382309562.png\" alt=\"\"></p>\n<p>我们将 JDK 统一放置在同一个目录下，比如  <code>D:\\Env\\Java</code></p>\n<p>脚本简单实现逻辑，就是将这指定目录下，所有子目录都找出来，并按顺序生成编号</p>\n<p>脚本根据用户输入的编号对应的目录，更新环境变量  <code>JAVA_HOME</code></p>\n<p>脚本内容如下 (<strong>特别注意： 使用 GBK 编码保存脚本文件，否则会中文乱码</strong>)：</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>@<span class=\"token function\">echo</span> off</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>:: 获取管理员执行权限</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">%</span>1 mshta vbscript:CreateObject<span class=\"token punctuation\">(</span><span class=\"token string\">\"Shell.Application\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>ShellExecute<span class=\"token punctuation\">(</span><span class=\"token string\">\"cmd.exe\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"/c %~s0 ::\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"runas\"</span><span class=\"token punctuation\">,</span>1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">)</span>&amp;&amp;<span class=\"token keyword\">exit</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>cd <span class=\"token operator\">/</span>d <span class=\"token string\">\"%~dp0\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>:: 设置容器大小 及 标题</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>mode con cols=120 lines=30</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>title JDK-Version change script of Bat</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>setlocal EnableDelayedExpansion</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>:menu</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">echo</span> 当前 JDK 版本:</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token function\">echo</span> <span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>java <span class=\"token operator\">-</span>version</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token function\">echo</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">echo</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token function\">echo</span> ========================================================</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token function\">echo</span> <span class=\"token comment\">################ JDK 版本切换，可选操作 ################</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token function\">echo</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token function\">echo</span>          <span class=\"token punctuation\">[</span>0<span class=\"token punctuation\">]</span>  取消切换</pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token function\">set</span> <span class=\"token string\">\"options=\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token function\">set</span> <span class=\"token string\">\"count=0\"</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>:: 指定根目录，遍历子文件夹</pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token operator\">/</span>d <span class=\"token operator\">%</span><span class=\"token operator\">%</span>d in <span class=\"token punctuation\">(</span><span class=\"token string\">\"D:\\Env\\Java\\*\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token function\">set</span> <span class=\"token operator\">/</span>a <span class=\"token string\">\"count+=1\"</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token function\">set</span> <span class=\"token string\">\"options=!options! !count!\"</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token function\">set</span> <span class=\"token string\">\"dir[!count!]=%%d\"</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>::<span class=\"token function\">echo</span> <span class=\"token function\">Select</span> a directory:</pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token operator\">%</span><span class=\"token operator\">%</span>i in <span class=\"token punctuation\">(</span><span class=\"token operator\">%</span>options%<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token function\">echo</span>          <span class=\"token punctuation\">[</span><span class=\"token operator\">%</span><span class=\"token operator\">%</span>i<span class=\"token punctuation\">]</span>  切换至版本： <span class=\"token operator\">!</span><span class=\"token function\">dir</span><span class=\"token punctuation\">[</span><span class=\"token operator\">%</span><span class=\"token operator\">%</span>i<span class=\"token punctuation\">]</span><span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token function\">echo</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token function\">echo</span> ========================================================</pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token function\">echo</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>:tipsChoose</pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token function\">set</span> <span class=\"token operator\">/</span>p <span class=\"token string\">\"choice=Enter the number of your choice: \"</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token string\">\"%choice%\"</span> EQU <span class=\"token string\">\"0\"</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>       goto <span class=\"token keyword\">exit</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token operator\">%</span>choice% gtr <span class=\"token operator\">%</span>count% <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token function\">echo</span> 请输入<span class=\"token punctuation\">[</span> 0 <span class=\"token operator\">--</span> <span class=\"token operator\">%</span>count% <span class=\"token punctuation\">]</span>范围内的数字</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token function\">echo</span> 》》》</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    goto tipsChoose</pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token function\">set</span> <span class=\"token string\">\"JAVA_HOME=!dir[%choice%]!\"</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token string\">\"!JAVA_HOME!\"</span> == <span class=\"token string\">\"\"</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token function\">echo</span> 获取的目录为空，请输入正确范围内的数字！</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    goto tipsChoose</pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>setx JAVA_HOME <span class=\"token string\">\"!JAVA_HOME!\"</span> <span class=\"token operator\">/</span>m</pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token function\">echo</span> JAVA_HOME 已切换至： <span class=\"token operator\">!</span>JAVA_HOME!</pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token function\">echo</span> 按任意键退出<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> &amp; pause > nul</pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>:<span class=\"token keyword\">exit</span></pre></td></tr></table></figure>",
            "tags": [
                "Shell",
                "Windows"
            ]
        },
        {
            "id": "http://xsea.cc/2023/02/37631c5.html",
            "url": "http://xsea.cc/2023/02/37631c5.html",
            "title": "Linux/Centos 环境Shell会话关闭后，本会话启动进程被终止",
            "date_published": "2023-02-13T13:27:04.000Z",
            "content_html": "<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/assets/css/APlayer.min.css\"><script src=\"/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><blockquote>\n<p>原因排查：Linux/Centos 环境 Shell 会话关闭后，本会话启动进程被终止</p>\n<p>记录下工作中遇到的问题，希望给遇到的小伙伴参考</p>\n</blockquote>\n<span id=\"more\"></span>\n<p>原文链接： <span class=\"exturl\" data-url=\"aHR0cHM6Ly9hc2suY3Nkbi5uZXQvcXVlc3Rpb25zLzc4ODEyOTQvNTQwNjA2OTE=\">Linux/Centos 环境 shell 会话关闭后，java 进程被结束</span></p>\n<h3 id=\"一-操作环境-软件版本等信息\"><a class=\"markdownIt-Anchor\" href=\"#一-操作环境-软件版本等信息\">#</a> 一、操作环境、软件版本等信息</h3>\n<blockquote>\n<p>Centos 7.9.2009</p>\n<p>Java8</p>\n</blockquote>\n<h3 id=\"二-问题场景\"><a class=\"markdownIt-Anchor\" href=\"#二-问题场景\">#</a> 二、问题场景：</h3>\n<blockquote>\n<p>1、 原启动命令  <code>java -jar xxx.jar &gt; test.log 2&gt;&amp;1 &amp;</code>  在  <code>start.sh</code>  脚本文件里</p>\n<p>2、有两台一样的服务器， 环境配置都一样； 之前一直是正常的（shell 会话关闭，也可正常运行）</p>\n<p>3、其中一台重启后，手动上去执行此脚本启动后；会话关闭进程就没了</p>\n</blockquote>\n<h3 id=\"三-尝试过的解决方法\"><a class=\"markdownIt-Anchor\" href=\"#三-尝试过的解决方法\">#</a> 三、尝试过的解决方法</h3>\n<blockquote>\n<p>1、 在命令前增加  <code>nohup</code>  ， 尝试无效</p>\n<p>2、 在命令前增加  <code>nohup</code>  ，并使用 exit 退出 shell 会话， 尝试无效</p>\n<p>3、 检查设置参数 shopt huponexit huponexit 原本值就为 off, 尝试重新设置后， 一样无效</p>\n<p>4、 使用  <code>screen</code>  启动， 尝试无效</p>\n</blockquote>\n<h3 id=\"四-最终排查原因-及-解决方案\"><a class=\"markdownIt-Anchor\" href=\"#四-最终排查原因-及-解决方案\">#</a> 四、最终排查原因 及 解决方案</h3>\n<h4 id=\"问题原因-ssh-版本被更新\"><a class=\"markdownIt-Anchor\" href=\"#问题原因-ssh-版本被更新\">#</a> 问题原因：  <code>SSH</code>  版本被更新</h4>\n<blockquote>\n<p>没问题的服务器 SSH 版本（旧的）： 7.4p1</p>\n<p>有问题的服务器 SSH 版本（新的）： 8.9p1</p>\n</blockquote>\n<h4 id=\"解决方案\"><a class=\"markdownIt-Anchor\" href=\"#解决方案\">#</a> 解决方案：</h4>\n<p>在  <code>ssh@.service</code>  中 [Service] 节点下，添加  <code>KillMode=process</code>  后</p>\n<p>使用命令  <code>systemctl restart sshd.service</code>  重启 sshd 服务</p>\n<p>参考连接：<br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vYnl6Z3NzL3AvMTU1NzMzNDQuaHRtbA==\">https://www.cnblogs.com/byzgss/p/15573344.html</span></p>\n",
            "tags": [
                "Linux",
                "Centos",
                "Shell"
            ]
        }
    ]
}